## 01 - Java虚拟机内存模型

> * 程序计数器
> * 虚拟机栈
> * 本地方法栈
> * Java堆
> * 方法区

可以分为线程共享和私有两大类：

线程共享：堆内存区、方法区、运行时常量池
线程私有：程序计数器、虚拟机栈

### 程序计数器

它是一块很小的内存空间，运行速度快，可以看成当前线程执行的字节码的行号指示器。在虚拟机中，字节码解释器的工作就是通过改变程序计数器来选择下一条需要执行的字节码指令、分支、循环、异常处理、跳转、线程恢复等。在多线程环境下，为了让线程切换
后恢复到正确的执行位置，每个线程都要有独立的程序计数器，各线程之间相互不影响、独立存储，因此程序计数器是线程私有的。

程序计数器类似于物理的寄存器的一种抽象模拟，因为是线程私有，所以生命周期和线程的生命同期一致。

根据JVM定义，程序计数器是唯一一个没有规定任何outOfMemoryError情况的区域。

### 虚拟机栈

虚拟机栈可以被快速访问，与程序计数器相同，线程私有，同Java线程在同一时间创建，保存方法的局部变量、部分结果，并参与方法的调用和返回。

Java虚拟机规范允许Java栈大小是动态或固定不变，规范定义了两种异常与栈空间有关，即StackoverFlowError和OutOfMemoryError。

**OutOfMemoryError**：如果栈可以动态扩展，而在扩展过程中没有足够的内存空间来支持栈的扩展，则程序运行过程中抛出OutOfMemoryError异常。
**StackoverFlowError**：线程计算过程中，请求的栈深度大于最大可用深度，则程序运行过程中招聘StackoverFlowError异常。

可以通过-XSS设置虚拟机栈的大小，栈的大小直接决定函数调用的最大可达深度。

#### 虚拟机栈内部结构

虚拟机栈在运行时使用一种叫栈帧的数据结构保存上下文数据，栈帧保存方法的局部变量表、操作数栈、动态连接方法和返回地址等信息。

> * 局部变量表


> * 操作数栈


> * 帧数据区



### 本地方法栈

### Java堆
