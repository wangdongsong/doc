# G1 



**并行**： 多线程的垃圾收集运算，当一个垃圾收集运算事件活动被描述为并行，说明它是用多线程来执行垃圾收集。  
**stop-the-world**：在一个垃圾收集事件上，所有的JAVA应用线程会部被暂停。当执行垃圾回操作时会暂停所有JAVA应用线程。  
**并发**：在JAVA应用执行过程中垃圾收集活动同时在进行。一个并发垃圾收集阶段或事件意味着这个垃圾收集阶段或事件可以和应用在同一时间执行。  

G1是一个并行回收器，把堆内存分割为很多不相关的区间（Region）。每个区间可以属于老年代或年轻代（新生代），并且每个年龄代区间可以是物理上不连续的。老年代
区间这个设计理念本身是为了服务于后台线程，这些线程的主要工作是寻找未被引用的对象（即垃圾），而这会产生一个现象，即某些区间的垃圾（未被引用的对象）多于其
他区间。G1 GC可以集中精力在垃圾多的区间上，并且只消耗一点时间可以清空这些区间里的垃圾，由于这种方式的侧重点在于处理垃圾最多的区间，所以命令为Garbage
First。

G1内部有四个阶段：

* 年轻代回收（A Young Collection）
* 运行在后台的并行循环（A Background， Concurrent Cycle）
* 混合回收（A Mixed Collection）
* 全量回收（A Full GC）


## G1涉及的术语

### Metaspace

元空间，使用本地内存，存储类元数据信息。由JDK7之前的PermGen（永久代）而来，有元空间之后，不会再出现Java.lang.OutOfMemoryError:PerGen。默认情况下，
大部分类元数据都在本地内存分配，只受可用的本地内存限制。  

一般情况下，适时的监控和调整元空间对于减小垃圾回收频率和减少延时很有必要。持续的元空间垃圾回收情况如果频繁发生，说明可能存在类、类加载器导致的内存泄漏或大小设置不合适。  

JDK8，因Metaspace进行动态扩展，以满足程序不断增长的类数据内存占用需求，因JVM动态扩容Metasapce空间，所以不会出现OOM事件。  

G1 GC与MetaSpace相关的选项如下：

* -XX:MetaspaceSize：初始化元空间的大小（默认12M（32 Client），16M（32 Server）， 64位比较大）
* -XX:MaxMetaspaceSize：最大元空间大小（默认本地内存）
* -XX:MinMetaspaceFreeRatio：扩大空间的最小比率，当GC后，内存占用超过这一比率，就会扩大空间。
* -XX:MaxMetaspaceFreeRatio：缩小空间比率，当GC后，内存占用低于这一比率就会缩小空间。
