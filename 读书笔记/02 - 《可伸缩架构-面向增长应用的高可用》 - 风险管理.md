# 什么是风险管理

所有复杂系统都存在风险，它是所有系统不可避免的一个部分。不可能消除复杂系统中的所有风险，但检查风险并确定风险的接受程序，对于保持系统健康非常重要。

## 管理风险

风险管理包括：确定系统中风险的位置；确定哪些风险必须消除|可存在|可接受；如何降低留存风险的可能性和严重性。

**示例**
风险发生，系统会遭受损失，这些损失包括公司或用户的数据丢失；无法给用户提供服务；无效响应或错误的结果。
避免方法：建设多节点应用、异常双活等措施
投入成本：机器设备、费用等
评估：成本的投入能否避免风险再次发生以及投入的可性行。

**风险管理**：就是在消除风险的成本和风险发生的成本之间保持平衡。

## 识别风险

风险管理的第一步列出所有已知风险，以及它们的危害性和发生的可能性。

最初的风险模型的创建需要团队的头脑风暴，可以从以下几个来源收集风险：

* 开发人员的头脑风暴
* 已知的重点售后支持问题
* 已知的安全风险和漏洞
* 已知的系统不完善或缺失能力
* 已知的性能瓶颈点
* 已知的流量峰值和变化
* 业务负责人、支持人员和用户的特殊考虑
* 已知的系统技术债务

建立风险模型还包括：风险出现的可能性、造成的影响分配优先级。

## 消除最严重的风险

根据风险列表识别最重要的风险事项，一旦识别高危风险，将其加入风险计划中，并定期检查它们是否依然存在。

## 风险缓和

对于所有风险，不管它们是不是最危险的，我们都尽可能地去思考有无降低发生风险几率或影响程度的办法，这些办法称之为：**风险缓和措施**。

风险缓和措施的价值很高，重点发现那些即能够降低风险又易于实现或成本合理的措施。

## 定期检查

确证风险模型之后，需不定期检查和回顾。在每次出现事故之后也需要重新检查模型，是否存在已知风险能够正确覆盖所发生的事故。

检查风险模型时，以下三点：

* 首先检查最近新增和确定的风险，并将它们添加为新的事项，同时移除已不存在的风险事项。
* 其次检查风险的严重性和可能性的变化。通常，风险缓和措施会帮助降低风险的严重性和可能性；或上次检查之后，风险发生变化 ，需要根据实际情况去调整。
* 最后检查是否有新的或更新后的风险事项需要被加入到模型中。

## 小结

管理系统中的风险步骤：

* 识别风险：创建一个系统的已知风险列表，即风险模型，对各个事项排列优先级。
* 消息最严重的风险： 找出列表中最大的风险，制订相应的解决计划。
* 风险缓和：对于无法暂时解决的主要风险，制定一个缓和计划降低风险发生的可能性和严重性。
* 定期检查：定期检查风险模型。


# 可能性与严重性

所有风险以下两方面组成：

严重性：发生风险时，所需要付出的代价。
可能性：风险发生的几率

管理风险就是管理严重性和可能性两个方面。

**风险的重要程度**就是风险发生的严重性和可能性两者之和。为了降低风险，需要至少降低其中之一，或者严重性，或者可能性。

示例：

* Top10排序列表：低可能性，低严重性。即如果Top10列表有异常，对用户和系统影响不大。
* 订单数据库：低可能性，高严重性。订单数据为核心组件，一般使用RAC和高质量的硬件。但数据库仍为单点，异常时，核心业务无法开展。

# 风险模型

风险模型包含以下几项内容：

* 风险ID：风险唯一标识，可以是任意类型。
* 系统：包含风险的系统。
* 所有人：负责该风险的个人（或团队）的名称，同时也是负责制订该风险的缓和计划和解决计划。
* 风险描述：该风险的概要描述。
* 标识日期：识别该风险并将其添加到模型中的日期。
* 可能性：标识该风险发生的可能性（分低、中、高三级）。
* 严重性：标识该风险发生的严重性或影响（分低、中、高三级）。
* 风险缓和计划：描述可以使用的或正在使用的，用来降低该风险严重性或可能性的风险缓和措施。
* 状态：该风险当前所处状态，通常值：活跃、已缓和、正在修复、已解决。
* ETA：表示风险距离计划解决日期（如果有计划时间）的估计时间。
* 监控：表示你对该风险的发生进行了监控，如果是，则包含你实现监控的步骤。如果没有监控，则标明原因以及计划对监控的估计时间。
* 触发计划：表示如果该风险真的发生，计划如何处理它，触发计划通常是一个管理层面的计划，而不是一个事件-响应计划。
* 备注：记录任何不适合记录的风险描述
* 跟踪ID：如果有缺陷系统或里程碑跟踪管理系统来管理风险，可以记录访风险在系统中的ID
* 历史：记录该风险在过去是否已经发生、时间、频率等。

## 风险模型作用域

推荐每个团队一个风险模型，通常由团队来决定要完成的功能或问题、及优先级，所以应当从团队层面管理风险模型，由团队决定各项风险的优先级。

## 创建风险模型

可借助风险模型，例如http://bit.ly/architectbookdl， 可以任意修改。建议第一次使用模板。

### 通过头脑风暴建立风险列表

准备好模型之后，首先通过头脑风暴得到一份风险列表，应当将尽可能想到的风险列出来。以下是头脑风暴比较好的来源：

* 开发团队：与开发团队一起会议，聆听他们的担忧，并将它们作为风险项添加到列表中。
* 售后支持：是否存在高于正常的售后支持压力问题？支持论坛等。
* 安全威胁：思考已知的安全威胁和漏洞。
* 待完成的功能列表：是否存在系统健康所缺失的关键能力？检查与监控和维护有关的功能。
* 性能：性能瓶颈点
* 业务负责人：业务负责人的担忧与顾虑。
* 相关团队：包含内部用户、附属团队、QA。听取他们的建议。
* 系统和流程：有无编写相应的文档？遗漏系统功能相关的必要的文档或只存在于少数几个人的头脑中。
* 技术债务：没有已知的、明确的技术债务？已知的技术债务都是风险项。

### 填写可能性和严重性字段

遍历列表，填写每一项风险的可能性和严重性，可采用低、中、高（或类似）的值。先写可能性，再写严重性。

**备注：**与开发团队进行另一次头脑风暴完成此项任务。与之前的获取风险项的头脑风暴分开进行。

### 风险项详情

按模板填写风险项的其它信息，包括系统、所有人、日期等字段。

### 缓和计划

首先从严重性最高的风险项开始制订风险缓和计划，再从可能性最高的风险开始。

缓和计划：是指现在或即将准备为降低风险严重性或可能性所采取的措施。缓和计划并不是要消除计划，只是降低风险的严重性和可能性。

不需要为所有风险项制订风险缓和计划。有些风险必须要解决，不能只降低可能性或严重性。

### 触发计划

触发计划是指当风险真正发生时需要采取的措施。从严重性最高的开始，为每个风险项制订相应的触发计划。

## 使用风险模型制订计划


创建风险模型后，所有计划会议都应该参考它，包括产品管理的长期计划会议、敏捷开发会议等。会议上应该询问的问题列表如下：

* 与上次检查相比，该风险是不是变严重？
* 是否在这次计划排期中，安排人员解决某些风险？
* 是否在这次计划排期中，安排人员执行缓和风险措施，降低它们的可能性或严重性？

## 维护风险模型

风险模型的最大挑战是模型本身容易变得过时，为保持风险模型内容的及时准确，应该与相关权益人定期检查，检查过程中，需要做以下几项工作：

* 发现新风险：系统中有无新增或近期识别出来的风险？确保在风险模型中。
* 删除旧的风险：删除无法再现的风险，或引发的原因已经被修复。请删除
* 更新可能性和严重性：可能性或严重性发生变化时更新风险项。通常近期的工作有利于降低风险的可能性或严重性。
* 检查优先级高的风险：检查所有高可能性或严重性风险，分别对他们讨论，确保所有信息都准确无误，是否可以制订新的缓和计划？有无监控？能否改善？
* 检查优先级低的风险：时间允许的话，检查低可能性和严重性风险，确认不被遗忘，以及确保不会被隐藏或错过任何应该提升它们优先级的机会和原因。

# 风险缓和

风险模型中的风险缓和计划列用来说明可以进行或正在进行哪些风险缓和措施，来降低当前风险的严重性、可能性。是为了知道当问题发生时应该做什么事情，能够尽可能降低问题所带来的影响。
是为了确保即使在服务或资源发生故障时，系统也能够尽可能完好的工作。

**风险缓和**：指的是通过降低风险发生的可能性，或降低风险发生时的严重性，来降低风险的影响。
**风险管理**：指的是在解决风险和风险缓和之间做出选择。需要考虑是否能够经济、及时解决风险，还是只需降低风险的影响即可。

## 恢复计划

风险发生之后，可通过*恢复计划*建立一系列操作，处理和修复风险所造成的影响和问题。

**备注**：恢复计划通常不会影响可能性，只会影响风险的严重性。

恢复计划是风险缓和的一种特殊类型，专用于降低风险发生的严重性。恢复计划描述一个已知风险发生后应采取的行为，包括以下几种：

* 尽可能迅速地停止问题的行为。
* 降低问题影响的临时行为。
* 通知用户问题情况的消息内容，以及他们可以采取的降低影响的行为。
* 上报问题的流程，以及需要通知的公司内部人员。让公司统一了解问题情况，一起处理问题和任何问题带来的波及问题。


恢复计划的内容应包括：

* 触发执行恢复计划的必要前提。
* 执行恢复计划需要涉及的人员列表。
* 执行恢复计划的详细步骤，以及每一步骤的负责人。
* 需要通知的管理人员、上级人员。
* 问题解决后必要的跟进措施。

**备注**：对于特别严重的风险，在发生时，需要列出详细的故障转移计划。故障转移的标准、确认流程、及后续清理工作。

## 容灾计划

容灾计划是一种恢复计划，主要用来描述当某种灾难发生时公司应采取哪些措施。**严重性很高，可能性很低**。

一个符合容灾计划的灾难例子是：一个或多个数据中心不可用。

它与恢复计划的区别在于缓和的风险的严重性、细节程度以及执行计划的投入。

## 改善我们的风险状况

风险缓和通过降低系统中风险的影响，是提高系统可靠性和可扩展性一个重要途径。现实中不一定能解决所有风险，但可以降低它的影响或严重性。通过风险缓和、恢复计划等措施达到我们期望的可用性程度。

# 构建低风险系统

## 冗余

冗余是一个提高系统可用性和可靠性的显著方式，同时也是降低系统的风险状况。同时也会增加系统复杂性，这又增加了风险。因此，重要的是控制增加冗余的复杂度以及实际中是否能对风险状况带来的可测量的改进效果。

以下是安全冗余改进示例：

* 将应用程序设计为可同时安全运行在多个独立硬件上。
* 将应用程序设计为可以独立运行的任务。
* 将应用程序设计为可以异步运行的任务。
* 将本地状态存储到一个指定区域。
* 尽可能使用幂等接口。幂等接口指的是可以重复调用的接口，无须担心一个动作被执行多次所带来的影响。幂等接口可以通过简单的重试机制可以实现错误恢复。\

## 增加复杂性的冗余改进

对于大多数应用系统而言，冗余改进看上去似乎有用，但却增加了系统复杂性，实际效果弊大于利。微服务是一个能够显著提高系统质量、降低风险的模型。

## 独立性

共享某个组件的一些组件看似独立，但都依赖于那个通用组件。这些共享组件不容易引起人注意，可能成为系统中的故障点。

独立性示例：运行5台独立的服务器，通过5台服务器增加系统整体的可用性，但5个台独立的服务器是否为运行在同一个硬件上的5台虚拟机？硬件是否为同一个机柜？机械是否为数据中心的同一层？同一个电源？

## 安全

在软件系统中，坏人永远是个问题。无论是对于高可用性，还是对于降低大规模系统的风险来说，高质量的安全措施都是必不可少的。**关键点**应该在风险分析、风险缓和以及开发过程中均考虑安全因素。
